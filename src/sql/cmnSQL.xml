<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>

<sqlMap namespace="board">
	<!-- 데이터를 꺼낼때 사용할것 설정 -->
	<typeAlias alias="board_CMN" type="model.cmnVO" />
<!-- 	<typeAlias alias="comment_CMN" type="model.cmnCommentVO" /> -->

	<!-- 리절트 맵 정의 -->
	<resultMap id="boardRes" class="board_CMN">
		<result property="no" column="Cmn_NO" />
		<result property="id" column="Member_ID" />
		<result property="subject" column="Cmn_SUBJECT" />
		<result property="content" column="Cmn_CONTENT" />
		<result property="count" column="Cmn_COUNT" />
		<result property="regdate" column="Cmn_REGDATE" />
		<result property="ref" column="Cmn_REF" />
		<result property="re_level" column="Cmn_RE_LEVEL" />
		<result property="re_step" column="Cmn_RE_STEP" />
		<result property="img" column="Cmn_IMG" />
		
	</resultMap>
<!-- 
	<resultMap id="commentRes" class="comment_CMN">
		<result property="cno" column="cmnc_no" />
		<result property="no" column="CMN_NO" />
		<result property="id" column="member_id" />
		<result property="content" column="cmnc_content" />
		<result property="regdate" column="cmnc_regdate" />
	</resultMap>
	 -->
	<sql id="CMN-select-all">
		SELECT * FROM board_CMN   
	</sql>

<!-- 	<sql id="CMN-select-com">
		SELECT * FROM CMN_COMMENT
	</sql>
	공통으로 사용할 where-no 절 정의
	<sql id="CMN-where-no">
		WHERE Cmn_NO= #no#
	</sql> -->
	<!-- select절 -->
	
		
		<select id="CMN-selectAll" resultMap="boardRes" parameterClass="int">
			<include refid="CMN-select-all"/>
			ORDER BY Cmn_ref DESC, Cmn_re_step ASC
		</select>
	<!-- 	
		<select id="CMN-selectOne" resultMap="boardRes" parameterClass="int">
			<include refid="CMN-select-all"/>
			<include refid="CMN-where-no"/>
		</select>
		
		<select id="CMNSeqNo" resultClass="int" >
			SELECT LAST_NUMBER  FROM USER_SEQUENCES WHERE SEQUENCE_NAME = UPPER('BOARD_CMN_NO_SEQ')
		</select>
		
		<select id="CMN-commentSelectAll" resultMap="commentRes" parameterClass="int">
			SELECT * FROM CMN_COMMENT
		 	WHERE cmn_no = #no#
		 	ORDER BY cmnc_no DESC
		</select>
		
		검색로직 추가시작
	<select id="CMN-selectSearchW" resultMap="boardRes" parameterClass="string">
		<include refid="CMN-select-all" />
		 WHERE Member_ID like #searchKeyword#
		 ORDER BY Cmn_NO DESC
	</select>
	
	<select id="CMN-selectSearchS" resultMap="boardRes" parameterClass="string">
		<include refid="CMN-select-all" />
		 WHERE Cmn_SUBJECT like #searchKeyword#
		 ORDER BY Cmn_NO DESC
	</select>
	
	<select id="CMN-selectSearchC" resultMap="boardRes" parameterClass="string">
		<include refid="CMN-select-all" />
		 WHERE Cmn_CONTENT like #searchKeyword#
		 ORDER BY Cmn_NO DESC
	</select>
	
		insert절
	<insert id="CMN-insertBoard" parameterClass="board_CMN">
		INSERT INTO BOARD_CMN(Cmn_NO, Cmn_SUBJECT, Member_ID, Cmn_CONTENT, Cmn_REGDATE,Cmn_RE_STEP,Cmn_RE_LEVEL,Cmn_REF,Cmn_COUNT, Cmn_IMG)
		VALUES (BOARD_CMN_NO_SEQ.NEXTVAL, #subject#, #id#, #content#, #regdate#, #re_step#, #re_level#, BOARD_CMN_NO_SEQ.CURRVAL, 0, #img#)
	</insert>
	
	<insert id="CMN-insertBoardReply" parameterClass="board_CMN">
		INSERT INTO BOARD_CMN(Cmn_NO, Cmn_SUBJECT, Member_ID, Cmn_CONTENT, Cmn_REGDATE,Cmn_RE_STEP,Cmn_RE_LEVEL,Cmn_REF,Cmn_COUNT)
		VALUES (BOARD_CMN_NO_SEQ.NEXTVAL, #subject#, #id#, #content#, #regdate#, #re_step#, #re_level#, #ref#, 0)
	</insert>
	
	<insert id="CMN-insertComment" parameterClass="comment_CMN">
		INSERT INTO CMN_COMMENT(CMNc_NO, CMN_NO, MEMBER_ID, CMNc_CONTENT, CMNc_REGDATE)
		VALUES (BOARDC_CMN_NO_SEQ.NEXTVAL, #no#, #id#, #content#, #regdate#)
	</insert>
	
	update절
	<update id="CMN-updateBoard" parameterClass="board_CMN">
	UPDATE BOARD_CMN SET Cmn_SUBJECT = #subject#, 
							Member_ID = #id#,
						Cmn_CONTENT = #content#
	<include refid = "CMN-where-no" />
	</update>
	
	<update id="CMN-updateCount" parameterClass="board_CMN">
		UPDATE BOARD_CMN SET Cmn_COUNT = Cmn_COUNT + 1
		<include refid="CMN-where-no" />
	</update>
	
	<update id="CMN-updateReplyStep" parameterClass="board_CMN">
		UPDATE BOARD_CMN SET Cmn_re_step=Cmn_re_step+1 WHERE Cmn_ref=#ref# AND Cmn_re_step>#re_step#
		
	</update>
	
	delete 쿼리문 정의
	<delete id="CMN-deleteBoard" parameterClass="board_CMN">
		DELETE FROM BOARD_CMN
		<include refid="CMN-where-no" />
	</delete>
	
	<delete id="CMN-deleteComment" parameterClass="comment_CMN">
		DELETE FROM CMN_COMMENT
		WHERE Cmnc_NO= #cno#
	</delete>
	 -->
</sqlMap>
	
	
	
	
	
	
	
	
	
	
	
	
	